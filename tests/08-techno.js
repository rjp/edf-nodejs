sys = require('sys');
assert = require('assert');
edf = require('edfparser');

var x = "<reply=\"user_login\"><userid=4/><name=\"Techno\"/><accesslevel=4/><gender=1/><description=\"UA's Mr Fixit. The buck stops here - all change please\n\nCode, coder, codest\"/><created=780841859/><stats><numlogins=12433/><totallogins=59267690/><longestlogin=124835/><nummsgs=34683/><totalmsgs=4482546/><lastmsg=1285337186/><numvotes=826/></><periodstats><numlogins=7014/><totallogins=29985709/><longestlogin=124835/><nummsgs=13445/><totalmsgs=1597003/><lastmsg=1285337186/><numvotes=370/></><details><email=\"mike@compsoc.man.ac.uk\"/><homepage=\"http://www.compsoc.man.ac.uk/~mike\"/><realname=\"Michael Wood\"/><pgpkey=\"THIS IS NOT REAL\"><type=1/></><picture/></><folders><marking=13/><archiving=1/><rule=1><and><folderid=125873/><keyword=\"php\"/></></><subscriber=1><name=\"General\"/></><subscriber=2><name=\"UA\"/></><subscriber=159><name=\"Bosses\"/></><subscriber=184><name=\"Social\"/></><subscriber=190><name=\"Sad\"/></><subscriber=210><name=\"Footy\"/></><subscriber=252><name=\"Net\"/></><subscriber=310><name=\"Programming\"/></><subscriber=348><name=\"Quotes\"/></><subscriber=384><name=\"Private\"/></><subscriber=421><name=\"Unix\"/></><subscriber=522><name=\"Computers\"/></><subscriber=637><name=\"Music\"/></><subscriber=728><name=\"Moan\"/></><subscriber=864><name=\"Sci-Fi\"/></><subscriber=867><name=\"Editors\"/></><subscriber=871><name=\"Money\"/></><subscriber=895><name=\"Work\"/></><subscriber=1019><name=\"Humour\"/></><subscriber=1036><name=\"Relationships\"/></><subscriber=1079><name=\"LAM\"/></><subscriber=1125><name=\"Sport\"/></><subscriber=1142><name=\"Chat\"/></><subscriber=1206><name=\"MP3\"/></><subscriber=1209><name=\"FAQ\"/></><subscriber=1254><name=\"Nostalgia\"/></><subscriber=1312><name=\"Long-Posts\"/></><subscriber=1316><name=\"Interesting-Things\"/></><subscriber=1326><name=\"Java\"/></><subscriber=1329><name=\"Abuse\"/></><subscriber=1381><name=\"Addresses\"/></><subscriber=1518><name=\"Happy\"/></><subscriber=1569><name=\"Games\"/></><subscriber=1581><name=\"CompSoc\"/></><subscriber=1593><name=\"Quotes.D\"/></><subscriber=1675><name=\"Long-Posts.D\"/></><subscriber=1690><name=\"Manc-Chat\"/></><subscriber=1723><name=\"Net-Deprecated\"/></><subscriber=1830><name=\"Nice\"/></><subscriber=1834><name=\"Networking\"/></><subscriber=1841><name=\"London-Chat\"/></><subscriber=1867><name=\"Gadgets\"/></><subscriber=1906><name=\"Media\"/></><subscriber=2044><name=\"News\"/></><subscriber=2048><name=\"News.D\"/></><subscriber=2054><name=\"Windows\"/></><subscriber=2200><name=\"Food\"/></><subscriber=2247><name=\"Databases\"/></><subscriber=2248><name=\"Graphics\"/></><subscriber=2249><name=\"Mornington-Crescent\"/></><subscriber=2257><name=\"Transport\"/></><subscriber=2296><name=\"Telecoms\"/></><subscriber=2430><name=\"New-Confs\"/></><subscriber=2431><name=\"Weather\"/></><subscriber=25717><name=\"Who-Lists-How-Boring\"/></><subscriber=30880><name=\"Books\"/></><subscriber=30913><name=\"Words\"/></><subscriber=36409><name=\"Science\"/></><subscriber=36566><name=\"UA-Dev\"/></><subscriber=45385><name=\"Polls\"/></><subscriber=47412><name=\"Polls.D\"/></><subscriber=48332><name=\"C\"/></><subscriber=111761><name=\"Filth\"/></><subscriber=118119><name=\"Christmas\"/></><subscriber=125873><name=\"Web-Dev\"/></><subscriber=141021><name=\"UA-Meet\"/></><subscriber=144187><name=\"Oscars\"/></><subscriber=157326><name=\"Piss-Poor-Humour\"/></><subscriber=171798><name=\"CPP\"/></><subscriber=238736><name=\"TwentySomething\"/></><subscriber=283787><name=\"Ex-Witness-Club\"/></><subscriber=299243><name=\"Applications\"/></><subscriber=307401><name=\"test1\"/></><subscriber=307405><name=\"test2\"/></><subscriber=334973><name=\"New-Features\"/></><subscriber=407100><name=\"Health\"/></><subscriber=439155><name=\"Shopping\"/></><subscriber=505047><name=\"Harry-Potter\"/></><subscriber=616411><name=\"Big-Brother\"/></><subscriber=655901><name=\"Travel\"/></><subscriber=798285><name=\"Archive\"/></><subscriber=798318><name=\"Bosses-info\"/></><subscriber=971488><name=\"Requests\"/></><subscriber=1034801><name=\"Quiz\"/></><subscriber=1142389><name=\"Photography\"/></><subscriber=1143347><name=\"Gardening\"/></><subscriber=1267207><name=\"Clique-of-the-day\"/></><subscriber=1391460><name=\"OLD\"/></><subscriber=1429083><name=\"Skibums\"/></><subscriber=1451362><name=\"Babies\"/></><subscriber=1891136><name=\"Spokespersons\"/></><subscriber=1902527><name=\"Twitter\"/></><subscriber=1979143><name=\"Not-Proogs\"/></></><client=\"sUAve v0.68\"><pagereturn=1/><viewtype=0/><caching=1/><systray=0/><returnsend=1/><hide=1/><fakepage=1/><customcolours=0/><custompictures=1/><confirm=3/><freeformsearch=1/><catchupaction=1/><menulevel=2/></><login=5175><status=257/><timeoff=1287791689/><timeon=1288196974/><requests=1/><location=\"Slicehost\"/><hostname=\"174-143-170-196.static.cloud-ips.com\"/><address=\"174.143.170.196\"/></><oldlogin><timeon=1287787948/><timeoff=1287791689/></><oldlogin><timeon=1285335266/><timeoff=1285337394/></><oldlogin><timeon=1285279725/><timeoff=1285281209/></><oldlogin><timeon=1285271090/><timeoff=1285279724/></><oldlogin><timeon=1284235549/><timeoff=1284237081/></></><announce=\"user_login\"><userid=4/><username=\"Techno\"/><connectionid=5175/><status=257/><timeoff=1287791689/><timeon=1288196974/><requests=1/><location=\"Slicehost\"/><hostname=\"174-143-170-196.static.cloud-ips.com\"/><address=\"174.143.170.196\"/><announcetime=1288196975/></>";

j = edf.parse(x);
e = JSON.parse(j);

exports['test parse count'] = function(test){
    test.expect(1);
    test.equals(e.parsed, 2, 'number of parsed nodes');
    test.done();
}

exports['test top node'] = function(test){
    test.expect(3);
    test.equals(e.trees[0].tag, 'reply', 'edf node');
    test.equals(e.trees[0].value, 'user_login', 'edf node');
    test.equals(e.trees[0].children.length, 17, 'edf node: one child');
    test.done();
}

exports['test second node'] = function(test){
    test.expect(3);
    test.equals(e.trees[1].tag, 'announce', 'edf node');
    test.equals(e.trees[1].value, 'user_login', 'edf node');
    test.equals(e.trees[1].children.length, 11, 'edf node: one child');
    test.done();
}
